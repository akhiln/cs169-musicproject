<html>
<head>
  <%= stylesheet_link_tag 'general' %>
  <%= stylesheet_link_tag 'jquery-ui' %>
  <%= stylesheet_link_tag 'jplayer.blue.monday' %>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
  <%= javascript_include_tag 'jquery.jplayer.min' %>
    <script type="text/javascript">
        jQuery.noConflict();
        var $j = jQuery;
    </script>
  <%= javascript_include_tag :defaults %>
 <script type="text/javascript">
<!--
$j(document).ready(function(){
	// Local copy of jQuery selectors, for performance.
	var jpPlayTime = $j("#jplayer_play_time");
	var jpTotalTime = $j("#jplayer_total_time");

	$j("#jquery_jplayer").jPlayer({
		ready: function() {
			displayPlayList();
			playListInit(true); // Parameter is a boolean for autoplay.
		},
		oggSupport: true
	})
	.jPlayer("onProgressChange", function(loadPercent, playedPercentRelative, playedPercentAbsolute, playedTime, totalTime) {
		jpPlayTime.text($j.jPlayer.convertTime(playedTime));
		jpTotalTime.text($j.jPlayer.convertTime(totalTime));
	})
	.jPlayer("onSoundComplete", function() {
		playListNext();
	});

	$j("#jplayer_previous").click( function() {
		playListPrev();
		$(this).blur();
		return false;
	});

	$j("#jplayer_next").click( function() {
		playListNext();
		$(this).blur();
		return false;
	});
});

	var playItem = 0;

	var myPlayList = [];
	
	function displayPlayList() {
		$j("#jplayer_playlist ul").empty();
		for (i=0; i < myPlayList.length; i++) {
			var listItem = (i == myPlayList.length-1) ? "<li class='jplayer_playlist_item_last'>" : "<li>";
			listItem += "<a href='#' id='jplayer_playlist_item_"+i+"' tabindex='1'>"+ myPlayList[i].name +"</a></li>";
			$j("#jplayer_playlist ul").append(listItem);
			$j("#jplayer_playlist_item_"+i).data( "index", i ).click( function() {
				var index = $(this).data("index");
				if (playItem != index) {
					playListChange( index );
				} else {
					$j("#jquery_jplayer").jPlayer("play");
				}
				$j(this).blur();
				return false;
			});
		}
	}

	function playListInit(autoplay) {

	}

	function playListConfig( index ) {
		$j("#jplayer_playlist_item_"+playItem).removeClass("jplayer_playlist_current").parent().removeClass("jplayer_playlist_current");
		$j("#jplayer_playlist_item_"+index).addClass("jplayer_playlist_current").parent().addClass("jplayer_playlist_current");
		playItem = index;
		$j("#jquery_jplayer").jPlayer("setFile", myPlayList[playItem].mp3, myPlayList[playItem].ogg);
	}

	function playListChange( index ) {
		playListConfig( index );
		$j("#jquery_jplayer").jPlayer("play");
	}

	function playListNext() {
		var index = (playItem+1 < myPlayList.length) ? playItem+1 : 0;
		playListChange( index );
	}

	function playListPrev() {
		var index = (playItem-1 >= 0) ? playItem-1 : myPlayList.length-1;
		playListChange( index );
	}
	
	function playListAdd(nameN, urlU) {
		myPlayList.push({name:nameN,mp3:urlU});
	}
	
	function playListAddAndPlay(nameN,urlU){
		myPlayList.push({name:nameN,mp3:urlU});
		playListChange(myPlayList.length-1);
	}
-->
</script>

</head>
<body>
<div id="main">
	<div id="app_header">
		<%= image_tag "logo.gif", :align=>"left" %>
		<div id="login_links">
			<% if current_user %>
			    <%= link_to_remote "Home", {:url=>root_path, :update=>'main_content'} %> |
				<%= link_to_remote "Edit Profile", {:url=>edit_user_path(:current), :update=>'main_content'} %> |
				<%= link_to "Logout", logout_path, :class => 'ajaxify' %>
			<% else %>
				<%= link_to_remote "Register", {:url=>signup_path, :update=>'main_content'} %> |
				<%= link_to_remote "Login", {:url=>login_path, :update=>'main_content'} %>
			<% end %>
		</div>
	</div>
	
	<div id="nav">
		<ul>
			<li>
				<%= link_to_remote "Popular Songs", {:url=>popular_songs_path(), :update => 'main_content'} %>
			</li>
			<li>
				<%= link_to_remote "Popular Playlists", {:url=>popular_playlists_path(), :update => 'main_content'} %>
			</li>
			<% if current_user %>
				<li>
					<%= link_to_remote "My Songs", {:url=>my_songs_path(), :update => 'main_content'} %>
				</li>
				<li>
					<%= link_to_remote "My Playlists", {:url=>my_playlists_path(), :update => 'main_content'} %>
				</li>
			<% end %>
			<li>
				<%= link_to_remote "Browse", {:url=>browse_path(), :update => 'main_content'} %>
			</li>
		</ul>
	</div>
	
	<div id="main_content">
		<%=yield%>
	</div>
	
</div>

<div id="persistent_player">
<div id="jquery_jplayer"></div>

<div class="jp-playlist-player">
	<div class="jp-interface">
		<ul class="jp-controls">
			<li><a href="#" id="jplayer_play" class="jp-play" tabindex="1">play</a></li>
			<li><a href="#" id="jplayer_pause" class="jp-pause" tabindex="1">pause</a></li>
			<li><a href="#" id="jplayer_stop" class="jp-stop" tabindex="1">stop</a></li>
			<li><a href="#" id="jplayer_volume_min" class="jp-volume-min" tabindex="1">min volume</a></li>
			<li><a href="#" id="jplayer_volume_max" class="jp-volume-max" tabindex="1">max volume</a></li>
			<li><a href="#" id="jplayer_previous" class="jp-previous" tabindex="1">previous</a></li>
			<li><a href="#" id="jplayer_next" class="jp-next" tabindex="1">next</a></li>
		</ul>
		<div class="jp-progress">
			<div id="jplayer_load_bar" class="jp-load-bar">
				<div id="jplayer_play_bar" class="jp-play-bar"></div>
			</div>
		</div>
		<div id="jplayer_volume_bar" class="jp-volume-bar">
			<div id="jplayer_volume_bar_value" class="jp-volume-bar-value"></div>
		</div>
		<div id="jplayer_play_time" class="jp-play-time"></div>
		<div id="jplayer_total_time" class="jp-total-time"></div>
	</div>
	<div id="jplayer_playlist" class="jp-playlist">
		<ul>
			<!-- The function displayPlayList() uses this unordered list -->
			<li></li>
		</ul>
	</div>
</div>
</div>

</body>
</html>s